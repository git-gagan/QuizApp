{% extends 'base.html'  %}

{% block content %}
<style>
    .default{
        display: inline;
        margin-left: 0;
        padding-left: 0;
    }
    label{
        display: block;
        padding-left: 0.5rem;
        border: 1px solid black;
    }
</style>
{% if Completed %}
    <h2>Thanks for taking the quiz</h2>
    <h3>Here are the results</h3>
    <a href="{% url 'result' page_number name %}">Go to Results...</a>
{% else %}
    <center><h3>You are playing the quiz : <i>{{ this_quiz }}</i></h3></center>
    {% if question %}
        <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="question" value="{{ question.id }}"/>
            {{ question }}
            {% if question.ques_type == "FIB" %}
                <input type="text" name="answer" placeholder="Answer here..." required>
                <br/>
            {% else %}
                <br/>
                {% for answer in answers %}
                <tr>
                    <label>
                        <td>
                            <input 
                                class="default" type="radio" value="{{ answer.solutions }}" 
                                id="{{ answer.solutions }}" name="choice" required
                            />
                        </td>
                        <td>{{ answer.solutions }}</td>
                    </label>
                    <br/>
                </tr>
                {% endfor %}
            {% endif %}
            <input type="Submit" value="Submit">
        </form>
    {% else %}
        <p>No questions to display!</p>
    {% endif %}
    <div align="center" id="displaytimer"><b>Timer: {% widthratio this_quiz.timer 1 60 %} seconds</b></div>
{% endif %}
<script>
        const timer = document.getElementById('displaytimer')
        t = {{ this_quiz.timer }} * 1
        var id = setInterval(timing, 1000)
        function timing(){
                t -= 1
                timer.innerHTML = "<b>Timer: " +t+" seconds</b>"
                if(t == 0){
                    timer.innerHTML = "<b>Time's Up!</b>"
                    clearInterval(id);
                    timeout()
                }
        }
        function timeout(){
            url = "/home/{{ page_number }}/{{ name }}/result"
            console.log("Timed out. Question remains unattempted")
            var xhr = new XMLHttpRequest();
            xhr.open("POST", url);
            xhr.setRequestHeader("Accept", "application/json");
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send({
                "incomplete":true, "csrfmiddlewaretoken": '{{ csrf_token }}'
            })
            //window.location.replace(url);
            //$.ajax({
            //       type:"POST",
            //      url: "/home/{{ page_number }}/{{ name }}/result",
            //      data:{}
            //  })
            }     
</script>
{% endblock %}