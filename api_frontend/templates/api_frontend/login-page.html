{% extends 'Base.html' %}

{% block content %}
<div class="container" id="parent">
    <h2>Login</h2>
    <form>
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" class="form-control" id="username" name="username" aria-describedby="UsernameHelp" placeholder="Enter Username" required />
        </div>
        <div class="form-group">
          <label for="email">Email address</label>
          <input type="email" class="form-control" id="email" name="email" aria-describedby="emailHelp" placeholder="Enter email" required />
          <small id="email" class="form-text text-muted">We'll never share your email with anyone else.</small>
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" class="form-control" id="password" name="password" placeholder="Password" required />
        </div>
        <button type="submit" class="btn btn-primary" onclick="login(event)">Login</button>
        <small>
            Need an account? <a href="{% url 'api-registration' %}">Register</a>
        </small>
    </form>
</div>
<script>
  document.cookie = `token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`
  h3 = document.createElement("h3")
  h3.innerHTML = ""
  function login(event){
    event.preventDefault()
    url = "/api/login/"
    var name = document.getElementById('username').value;
    var email = document.getElementById('email').value;
    var password = document.getElementById('password').value
    fetch(url, {
      method: "post",
      body: JSON.stringify({
        username: name,
        email: email,
        password: password
      }),
      headers: {
          "Content-type": "application/json; charset=UTF-8"
      }})
      .then(response => response.json())
      .then((json) => {
        console.log(json)
        if("token" in json){
          document.cookie = `token=${json.token};path=/`;
          if(json.status === "Logged In"){
            window.location.replace("http://127.0.0.1:8000/api-quizzes/quiz/")
          }
          else{
            window.location.replace("http://127.0.0.1:8000/api-quizzes/api-verification/")
          }          
        }
        else{
          h3.innerHTML = json.status
          h3.style.backgroundColor = "red"
          h3.style.margin = "1rem"
          h3.style.padding = "1rem"
          h3.style.width = "100%"
          h3.style.textAlign = "center"
          document.getElementById("parent").prepend(h3)
        }
      })
 }
</script>
{% endblock %}